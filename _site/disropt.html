<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>DISROPT - A Tutorial on Distributed Optimization for Cooperative Robotics</title>
<meta name="description" content="">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="A Tutorial on Distributed Optimization for Cooperative Robotics">
<meta property="og:title" content="DISROPT">
<meta property="og:url" content="http://0.0.0.0:4000/disropt">












  

  


<link rel="canonical" href="http://0.0.0.0:4000/disropt">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Andrea Testa",
      "url": "http://0.0.0.0:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="A Tutorial on Distributed Optimization for Cooperative Robotics Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          A Tutorial on Distributed Optimization for Cooperative Robotics
          <span class="site-subtitle">from Setups and Algorithms to Toolboxes and Research Directions</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Home</a>
            </li><li class="masthead__menu-item">
              <a href="/tutorial">Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="/citeus">Cite us</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="DISROPT">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://0.0.0.0:4000/disropt" class="u-url" itemprop="url">DISROPT
</a>
          </h1>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#introduction-to-disropt">Introduction to DISROPT</a><ul><li><a href="#objective-functions-and-constraints">Objective functions and constraints</a></li><li><a href="#optimization-problems">Optimization Problems</a></li><li><a href="#agents-in-the-network">Agents in the network</a></li><li><a href="#distributed-optimization-algorithms">Distributed Optimization Algorithms</a></li></ul></li><li><a href="#constraint-coupled-charging-of-plug-in-electric-vehicles-pevs">Constraint-coupled: charging of Plug-in Electric Vehicles (PEVs)</a><ul><li><a href="#problem-formulation">Problem formulation</a></li><li><a href="#data-generation-model">Data generation model</a></li><li><a href="#complete-code">Complete code</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <h2 id="introduction-to-disropt">Introduction to DISROPT</h2>

<p><strong>DISROPT</strong> is a Python package for distributed optimization over peer-to-peer networks of computing units called agents.</p>

<h3 id="objective-functions-and-constraints">Objective functions and constraints</h3>

<p><strong>DISROPT</strong> comes with many already implemented mathematical functions.
Functions are defined in terms of optimization variables (<code class="language-plaintext highlighter-rouge">Variable</code>) or other functions. A variable in \(x\in\mathbb{R}^{2}\) can be defined as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from disropt.functions import Variable
n = 2 # dimension of the variable
x = Variable(n)
</code></pre></div></div>

<p>Now, suppose you want to define an affine function \(f(x)=A^\top x - b\) with \(A\in\mathbb{R}^{2\times 2}\) and \(b\in\mathbb{R}^2\)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import numpy as np
a = 1
A = np.array([[1,2], [2,4]])
b = np.array([[1], [1]])
f = A @ x - b
</code></pre></div></div>

<p>Constraints are represented in the canonical forms \(f(x)=0\) and \(f(x)\leq 0\).</p>

<p>They are directly obtained from functions::</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>constraint = g == 0 # g(x) = 0
constraint = g &gt;= 0 # g(x) &gt;= 0
constraint = g &lt;= 0 # g(x) &lt;= 0
</code></pre></div></div>

<p>On the right side of (in)equalities, numpy arrays and functions (with appropriate shapes) are also allowed::</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c = np.random.rand(2,1)
constr = f &lt;= c
</code></pre></div></div>

<p>which is automatically translated in the corresponding canonical form.</p>

<h3 id="optimization-problems">Optimization Problems</h3>

<p>The <code class="language-plaintext highlighter-rouge">Problem</code> class allows one to define optimization problems of various types. Consider the following problem:</p>

\[\begin{eqnarray}
\text{minimize } &amp; \| A^\top x - b \| \\
    \text{subject to } &amp; x \geq 0
\end{eqnarray}\]

<p>with \(x\in\mathbb{R}^4\). We can define it as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import numpy as np
from disropt.problems import Problem
from disropt.functions import Variable, Norm

x = Variable(4)
A = np.random.randn(n, n)
b = np.random.randn(n, 1)

obj = Norm(A @ x - b)
constr = x &gt;= 0

pb = Problem(objective_function = obj, constraints = constr)
</code></pre></div></div>

<p>In the distributed framework of <strong>DISROPT</strong>, the <code class="language-plaintext highlighter-rouge">Problem</code> class is mainly meant to define portions of a bigger optimization problem that are locally known to local computing units. However, since in many distributed optimization algorithms can be requested to solve local optimization problems, we implemented some problem solvers. If the problem is convex, it can be solved as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>solution = pb.solve()
</code></pre></div></div>

<p>Generic (convex) nonlinear problems of the form</p>

\[\begin{eqnarray}

    \text{minimize } &amp; f(x) \\

    \text{subject to } &amp; g(x) \leq 0 \\

                        &amp; h(x) = 0
\end{eqnarray}\]

<p>are solved through the cvxpy solver (when possible), or with the cvxopt solver, while more structured problems (LPs and QPs) can be solved through other solvers (osqp and glpk). Mixed-Integer Problems can be solved using gurobi.</p>

<h3 id="agents-in-the-network">Agents in the network</h3>

<p>The <code class="language-plaintext highlighter-rouge">Agent</code> class is meant to represent the local computing units that collaborate in the network in order to solve some specific problem.</p>

<p>Agents are instantiated by defining their in/out-neighbors and the weights they assign their neighbors. For example, consider the following network</p>

<center>
<img src="/images/network.png" />
</center>

<p>Then, agent 0 is defined as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from disropt.agents import Agent

agent = Agent(in_neighbors=[1,2],
              out_neighbors=[2],
              weights=[0.3, 0.2])
</code></pre></div></div>

<p>Assigning a local optimization problem to an agent is done via the <code class="language-plaintext highlighter-rouge">set_problem</code> method, which modifies the <code class="language-plaintext highlighter-rouge">problem</code> attribute of the agent. Consider the following code</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> from disropt.problems import Problem
 from disropt.functions import Variable, Norm
 x = Variable(4)
 A = np.random.randn(n, n)
 b = np.random.randn(n, 1)
 obj = Norm(A @ x - b)
 constr = x &gt;= 0
 pb = Problem(objective_function = obj, constraints = constr)
</code></pre></div></div>

<p>Assume that the variable <code class="language-plaintext highlighter-rouge">problem</code> contains the local problem data. Then, the variable is assigned to the agent by</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>agent.set_problems(problem)
</code></pre></div></div>

<h3 id="distributed-optimization-algorithms">Distributed Optimization Algorithms</h3>

<p>In <strong>DISROPT</strong>, there are many implemented distributed optimization algorithms. Each algorithm is tailored
for a specific distributed optimization set-up. We refer the reader to the <a href="https://disropt.readthedocs.io/en/latest/index.html">DISROPT documentation page</a> for a detailed explanation.</p>

<h2 id="constraint-coupled-charging-of-plug-in-electric-vehicles-pevs">Constraint-coupled: charging of Plug-in Electric Vehicles (PEVs)</h2>

<p>We now consider the problem of determining an optimal overnight charging schedule for a fleet of Plug-in Electric Vehicles (PEVs).</p>

<h3 id="problem-formulation">Problem formulation</h3>

<p>Suppose there is a fleet of <code class="language-plaintext highlighter-rouge">N</code> PEVs (agents) that must be charged by drawing power from
the same electricity distribution network. Assuming the vehicles are connected to the grid
at a certain time (e.g., at midnight), the goal is to determine an optimal overnight schedule
to charge the vehicles, since the electricity price varies during the charging period.</p>

<p>Formally, we divide the entire charging period into a total of :math:<code class="language-plaintext highlighter-rouge">T = 24</code> time slots,
each one of duration :math:<code class="language-plaintext highlighter-rouge">\Delta T = 20</code> minutes. For each PEV :math:<code class="language-plaintext highlighter-rouge">i \in \{1, \ldots, N\}</code>,
the charging power at time step :math:<code class="language-plaintext highlighter-rouge">k</code> is equal to :math:<code class="language-plaintext highlighter-rouge">P_i u_i(k)</code>, where :math:<code class="language-plaintext highlighter-rouge">u_i(k) \in [0, 1]</code>
is the input to the system and :math:<code class="language-plaintext highlighter-rouge">P_i</code> is the maximum charging power that can be fed to the
:math:<code class="language-plaintext highlighter-rouge">i</code>-th vehicle.</p>

<p>System model
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
The state of charge of the :math:<code class="language-plaintext highlighter-rouge">i</code>-th battery is denoted by :math:<code class="language-plaintext highlighter-rouge">e_i(k)</code>,
its initial state of charge is :math:<code class="language-plaintext highlighter-rouge">E_i^\text{init}</code>, which by the end of the charging
period has to attain at least :math:<code class="language-plaintext highlighter-rouge">E_i^\text{ref}</code>. The charging conversion efficiency
is denoted by :math:<code class="language-plaintext highlighter-rouge">\zeta_i^\text{u} \triangleq 1 - \zeta_i</code>, where :math:<code class="language-plaintext highlighter-rouge">\zeta_i &gt; 0</code>
encodes the conversion losses. The battery’s capacity limits are denoted by
:math:<code class="language-plaintext highlighter-rouge">E_i^\text{min}, E_i^\text{max} \ge 0</code>. The system’s dynamics are therefore given by</p>

<p>.. math::</p>

<p>&amp; : e_i(0) = E_i^\text{init}
  <br />
  &amp; : e_i(k+1) = e_i(k) + P_i \Delta T \zeta_i^u u_i(k), \hspace{0.5cm} k \in {0, \ldots, T-1}
  <br />
  &amp; : e_i(T) \ge E_i^\text{ref}
  <br />
  &amp; : E_i^\text{min} \le e_i(k) \le E_i^\text{max}, \hspace{2.88cm} k \in {1, \ldots, T}
  <br />
  &amp; : u_i(k) \in [0,1], \hspace{4.47cm} k \in {0, \ldots, T-1}.</p>

<p>To model congestion avoidance of the power grid, we further consider the following (linear)
coupling constraints among all the variables</p>

<p>.. math::</p>

<p>\sum_{i=1}^N P_i u_i(k) \le P^\text{max}, \hspace{1cm} k \in {0, \ldots, T-1},</p>

<p>where :math:<code class="language-plaintext highlighter-rouge">P^\text{max}</code> is the maximum power that the be drawn from the grid.</p>

<p>Optimization problem
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
We assume that, at each time slot :math:<code class="language-plaintext highlighter-rouge">k</code>, electricity has unit cost equal to
:math:<code class="language-plaintext highlighter-rouge">C^\text{u}(k)</code>. Since the goal is to minimize the overall consumed energy price,
the global optimization problem can be posed as</p>

<p>.. math::</p>

<p>\min_{u, e} : &amp; : \sum_{i=1}^N \sum_{k=0}^{T-1} C^\text{u}(k) P_i u_i(k)
  <br />
  \text{subject to} : &amp; : \sum_{i=1}^N P_i u_i(k) \le P^\text{max}, \hspace{1cm} k \in {0, \ldots, T-1}
  <br />
  &amp; : (u_i, e_i) \in X_i, \hspace{2.4cm} : i \in {1, \ldots, N}.</p>

<p>The problem is recognized to be a :ref:<code class="language-plaintext highlighter-rouge">constraint-coupled &lt;tutorial&gt;</code> problem,
with local variables :math:<code class="language-plaintext highlighter-rouge">x_i</code> equal to the stack of :math:<code class="language-plaintext highlighter-rouge">e_i(k), u_i(k)</code> for :math:<code class="language-plaintext highlighter-rouge">k \in \{0, \ldots, T-1\}</code>,
plus :math:<code class="language-plaintext highlighter-rouge">e_i(T)</code>. The local objective function is equal to</p>

<p>.. math::</p>

<p>f_i(x_i) = \sum_{k=0}^{T-1} P_i u_i(k) C^\text{u}(k),</p>

<p>the local constraint set is equal to</p>

<p>.. math::</p>

<p>X_i = {(e_i, u_i) \in \mathbb{R}^{T+1} \times \mathbb{R}^T \text{ such that local dynamics is satisfied} }</p>

<p>and the local coupling constraint function :math:<code class="language-plaintext highlighter-rouge">g_i : \mathbb{R}^{2T+1} \rightarrow \mathbb{R}^T</code> has components</p>

<p>.. math::</p>

<p>g_{i,k}(x_i) = P_i u_i(k) - \frac{P^\text{max}}{N}, \hspace{1cm} k \in {0, \ldots, T-1}.</p>

<p>The goal is to make each agent compute its portion :math:<code class="language-plaintext highlighter-rouge">x_i^\star = (e_i^\star, u_i^\star)</code>
of an optimal solution :math:<code class="language-plaintext highlighter-rouge">(x_1^\star, \ldots, x_N^\star)</code> of the optimization problem,
so that all of them can know their own assignment of the optimal charging schedule, given by
:math:<code class="language-plaintext highlighter-rouge">(u_i^\star(0), \ldots, u_i^\star(T-1))</code>.</p>

<h3 id="data-generation-model">Data generation model</h3>

<p>The data are generated according to table in [VuEs16]_ (see Appendix).</p>

<p>.. Simulation results
.. ————————————–</p>

<p>.. We run a comparative study with :math:<code class="language-plaintext highlighter-rouge">N = 50</code> agents with the following distributed algorithms:</p>

<p>.. * :ref:<code class="language-plaintext highlighter-rouge">Distributed Dual Subgradient &lt;alg_dual_subgradient&gt;</code>
.. * :ref:<code class="language-plaintext highlighter-rouge">Distributed Primal Decomposition &lt;alg_primal_decomp&gt;</code></p>

<p>.. For the Distributed Primal Decomposition algorithm, we choose a sufficiently large parameter :math:<code class="language-plaintext highlighter-rouge">M = 100</code>.
.. As for the step-size, we use for both algorithms the diminishing rule :math:<code class="language-plaintext highlighter-rouge">\alpha^k = \frac{1}{k^{0.6}}</code>.</p>

<p>.. In the following figures we show the evolution of the two algorithms…… TODO figures:</p>

<p>.. * cost convergence
.. * coupling constraint value</p>

<h3 id="complete-code">Complete code</h3>
<hr />
<p>.. _pev_code:</p>

<p>.. literalinclude:: ../../../../examples/setups/pev/launcher.py
  :caption: examples/setups/pev/launcher.py</p>

<p>.. literalinclude:: ../../../../examples/setups/pev/results.py
  :caption: examples/setups/pev/results.py</p>

<p>The two files can be executed by issuing the following commands in the example folder:</p>

<p>.. code-block:: bash</p>

<blockquote>
  <p>mpirun -np 50 –oversubscribe python launcher.py
python results.py</p>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Andrea Testa. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>









    <script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  </body>
</html>

